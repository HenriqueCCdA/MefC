/*********************************************************************
 * Usado para complilacao no visual stdio 2008 por causa de warnings *
 * ------------------------------------------------------------------*
 *********************************************************************/
#define _CRT_SECURE_NO_DEPRECATE
/*********************************************************************/
/*******************Defines*******************************************/
/* ... Depuracao de erros*/
#define NAMESRC "File.c"/*nome desse arquivo fonte*/
/*-------------------------------------------------------------------*/
/*********************************************************************/

/******************************Includes*******************************/
/**/
/*--- Pradão do C*/
#include <stdio.h>
#include <math.h>
#include <stdlib.h>
#include <string.h>
/*-------------------------------------------------------------------*/
/**/
/*--- Proprios*/
#include <Tipos_Wave.h>
#include <Global_Wave.h>
/*-------------------------------------------------------------------*/
/*********************************************************************/


/*********************Prototipos das funcoes**************************/
/*...*/
void open_file ( long istep, int inst  ,int soft);
void close_file( int inst  , int soft );
/*...................................................................*/
/**/
/*...*/
void fname (long istep,int inst,int soft, char *out );
/*...................................................................*/
/**/
/*...*/
void iota ( long t , char* st );
/*...................................................................*/
/*********************************************************************/
/**/
/*********************************************************************
 * fname: add as extencoes dos arquivos de saida                     *
 * ------------------------------------------------------------------*
 * Parametros de entrada:                                            *
 * ------------------------------------------------------------------* 
 * out   -> nome do arquivo de saida                                 * 
 * istep -> passo no tempo                                           *
 * inst  -> codigo                                                   *
 *          1 -> geometria                                           *
 *          2 -> resultados                                          *
 * soft  -> codigo                                                   *
 *          1 -> gid                                                 *
 *          2 -> vtk                                                 *
 * ------------------------------------------------------------------*
 * Paramanetros de saida:                                            *
 * ------------------------------------------------------------------*
 * out -> aruivo de saida com a extencao                             * 
 * ------------------------------------------------------------------*
 * *******************************************************************/
void fname( long istep , int inst , int soft , char *out ){
/*===*/
  char temp[65];
/*===================================================================*/
/**/
/*===*/
  switch( inst ) {
/*#### geometira*/
    case 1:
/*... Gid*/
      if( soft == 1 ){
        strcpy(out,arqsaida);
        strcat(out,".msh");  
      }
/*...................................................................*/
/**/
/*... vtk*/
      else if( soft == 2 ){
        strcpy(out,arqsaida );
        strcat(out,"_geo.vtk" );
      }
/*...................................................................*/
/**/
/*...*/
      else {
        printf("\nSotware escolhido invalido\n"
             "funcao fname(*,*,*)\narquivo %s\n",NAMESRC);
        exit(0);
      }
/*...................................................................*/
      break;
/*###################################################################*/
/**/
/*### resultados*/
    case 2:
/*... Gid*/
      if( soft == 1 ){
         strcpy( out , arqsaida );
         strcat( out , ".res" );
       }
/*...................................................................*/
/**/
/*... Vtk*/
      else if( soft == 2 ){
         strcpy ( out , arqsaida );
         iota ( istep , temp );
         strcat( out ,"_res." );
         strcat( out , temp );
         strcat( out ,".vtk");
      }  
/*...................................................................*/
/**/
/*...*/
      else{
        printf("\nSotware escolhido invalido\n"
             "funcao fname(*,*,*)\narquivo %s\n",NAMESRC);
        exit(0);
      }
/*...................................................................*/
      break;     
/*###################################################################*/
/**/
/*###*/
    default:
        printf("\n opcao invalida\n"
             "funcao fname(*,*,*)\narquivo = %s\n",NAMESRC);
        exit(0);
      break;
/*###################################################################*/
  }
/*===================================================================*/
}
/*********************************************************************/
/**/
/*********************************************************************
 * open_file:                                                        *
 *********************************************************************
 * ------------------------------------------------------------------*
 * Parametros de entrada:                                            *
 * ------------------------------------------------------------------* 
 * inst  -> codigo                                                   *
 *          1 -> geometria                                           *
 *          2 -> resultados                                          *
 * soft  -> cadigo                                                   *
 *          1 -> gid                                                 *
 *          2 -> vtk                                                 *
 * ------------------------------------------------------------------*
 * Paramanetros de saida:                                            *
 * ------------------------------------------------------------------*
 * ------------------------------------------------------------------*
 *********************************************************************/
void open_file( long istep , int  inst , int soft ){
/*===*/
  char out[ NAMEFILE + 5 ];   
/*===================================================================*/
/**/
/*=== nome do arquivo*/
  fname(istep,inst,soft,out);
/*===================================================================*/
/*=== abrindo o arquivo*/
  if(  (fileout1 = fopen(out,"w"))== NULL){
    fprintf(stderr,"\nErro na criação do arquivo de saida %s,\n ",out);
    exit(0);
    }
    fprintf(stderr,"Sucesso na criação do arquivo %s.\n ", out);
/*===================================================================*/
 }
/*********************************************************************/
/**/
/*********************************************************************
 * close_file:                                                       *
 *********************************************************************
 * ------------------------------------------------------------------*
 * Parametros de entrada:                                            *
 * ------------------------------------------------------------------* 
 * istep -> posso no tempo
 * inst  -> codigo                                                   *
 *          1 -> geometria                                           *
 *          2 -> resultados                                          *
 * soft  -> cadigo                                                   *
 *          1 -> gid                                                 *
 *          2 -> vtk                                                 *
 * ------------------------------------------------------------------*
 * Paramanetros de saida:                                            *
 * ------------------------------------------------------------------*
 * ------------------------------------------------------------------*
 *********************************************************************/
void close_file( int inst  , int soft ){
/*===*/
  switch (inst){
/*### Geometria*/
   case 1:
/*... saida para usuario(debug)*/
    if(FLAG_DEBUG == 1)
    fprintf(stderr,"\n***************************************\n"
                   "Fechando arquivo de geometria.\n"
                    "***************************************\n"); 
/*...................................................................*/
/**/
/*...*/
     fclose(fileout1);
/*...................................................................*/
   break;
/*###################################################################*/
/**/
/*####Resultado*/
   case 2:
/*... Gid*/
     if ( soft == 1 ){
/*---saida para usuario(debug)*/
         if(FLAG_DEBUG == 1)
           fprintf(stderr,"\n***************************************\n"
                          "Fechando arquivo de resultados do gid.\n"
                          "***************************************\n"); 
/*-------------------------------------------------------------------*/
/**/
/*---*/
       fclose(fileout1);
/*-------------------------------------------------------------------*/
       }   
/*...................................................................*/
/**/
/*... Vtk*/
     else if( soft == 2 ){
/*---saida para usuario(debug)*/
         if(FLAG_DEBUG == 1)
           fprintf(stderr,"\n***************************************\n"
                          "Fechando arquivo de resultados do vtk.\n"
                          "***************************************\n"); 
/*-------------------------------------------------------------------*/
/**/
/*---*/
       fclose(fileout1); 
/*-------------------------------------------------------------------*/
     }
     else{
       printf("\nSotware escolhido invalido\n"
             "funcao close_file(*,*,*)\n arquivo %s\n",NAMESRC);
       exit(0);
     }
/*...................................................................*/ 
     break;
/*###################################################################*/
/*###*/
  default:
    printf("\n opcao invalida\n"
             "funcao close_file(*,*,*)\n arquivo %s\n",NAMESRC);
    exit(0);
    break;
/*###################################################################*/
  }
/*===================================================================*/
}
/*********************************************************************/
/**/
/*********************************************************************
 * ito:pegar o valor de um interio e trasnforma em uma cadeia de     *
 * caracter.                                                         *
 *********************************************************************
 * ------------------------------------------------------------------*
 * Parametros de entrada:                                            *
 * ------------------------------------------------------------------*
 * istep -> posso no tempo                                           *
 * ------------------------------------------------------------------*
 * Paramanetros de saida:                                            *
 * ------------------------------------------------------------------*
 * st -> string com a volar de istep                                 *
 * ------------------------------------------------------------------*
 *********************************************************************/
void iota( long t , char* st ){
/*...*/
  char c;
  int n , dec , j , k;
/*...................................................................*/
/**/
/*...*/
  n = ( t > 0 )? ( log10(t) + 1 ): 1;
  st[n] = '\0'; 
/*...................................................................*/
/**/
/*...*/
  dec = 10 ;   
  for( j = n - 1 ; j >= 0 ; --j ){
    k = ( t % dec ) / ( dec / 10 );
    c = k + '0';
    st[j] = c;
    dec = dec * 10;
  }
/*...................................................................*/
}
/*********************************************************************/ 
 
